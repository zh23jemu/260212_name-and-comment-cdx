# 课堂互动分组管理功能说明

## 功能概述

为课堂教学主界面添加了完整的分组管理功能，教师可以通过拖拽方式对学生进行分组管理。学生数据从数据库实时加载，支持多班级管理。

## 文件清单

### 新增文件

1. **课堂互动分组管理.html** - 分组管理主页面
   - 提供4个分组卡片
   - 支持拖拽式分组操作
   - 自动分组和重置功能
   - 数据持久化保存
   - 从数据库加载真实学生数据
   - 支持班级选择切换

2. **assets/static/group-management.js** - 分组管理工具脚本
   - `openGroupManagement()` - 打开分组管理窗口
   - `loadGroupData()` - 加载分组数据
   - 自动监听数据更新

3. **分组管理测试页.html** - 功能测试页面
   - 演示如何使用分组管理功能
   - 查看和管理分组数据
   - 显示详细的学生名单

4. **分组管理功能说明.md** - 本文档

### 修改文件

1. **课堂教学主界面.html**
   - 引入 `group-management.js` 脚本
   - 为"分组设置"按钮添加点击事件处理
   - 添加班级选择监听

## 功能特性

### 1. 拖拽式分组
- 拖拽学生卡片到不同分组
- 拖拽到待分配池取消分组
- 实时显示每组人数

### 2. 自动分组
- 一键随机平均分配学生
- 自动打乱顺序确保公平性

### 3. 分组管理
- 清空单个分组
- 重置所有分组
- 从待分配池添加成员

### 4. 数据持久化
- 使用 localStorage 保存分组数据
- 跨页面数据共享
- 自动同步更新

## 使用方法

### 教师端操作流程

1. **打开分组管理**
   - 在课堂教学主界面点击"分组设置"按钮
   - 系统将在新窗口打开分组管理页面

2. **选择班级**
   - 在页面顶部的下拉菜单中选择要管理的班级
   - 系统自动从数据库加载该班级的学生数据
   - 如果之前已保存过分组，会自动恢复

3. **进行分组操作**
   - 方式一：拖拽学生卡片到目标分组
   - 方式二：点击"自动分组"按钮智能分配
   - 方式三：使用"从池添加"按钮逐个添加

4. **保存分组**
   - 点击"完成确认并保存"按钮
   - 分组数据自动保存到本地
   - 下次打开会自动恢复分组状态

5. **查看分组**
   - 分组数据在小组积分榜中显示
   - 可随时重新打开分组管理页面调整

### 测试方法

```bash
# 启动本地服务器
python -m http.server 8000

# 在浏览器中打开测试页面
start http://localhost:8000/分组管理测试页.html

# 或直接打开课堂教学主界面
start http://localhost:8000/课堂教学主界面.html
```

## 技术实现

### 数据来源

学生数据从后端数据库实时加载：

```javascript
// 从数据库加载学生数据
async function loadStudentsFromDB() {
  const currentClassId = localStorage.getItem('currentClassId');
  const response = await fetch(`/api/classes/${currentClassId}/students`, {
    credentials: 'include'
  });
  const data = await response.json();
  return data.map(student => ({
    id: student.id,
    name: student.name,
    studentNo: student.studentNo
  }));
}
```

### 数据结构

```javascript
{
  group1: [
    { id: 1, name: '张三', studentNo: '001' },
    { id: 2, name: '李四', studentNo: '002' }
  ],
  group2: [...],
  group3: [...],
  group4: [...],
  unassigned: [...]  // 未分配学生
}
```

### 存储方式

- 使用 `localStorage.setItem('classroomGroups', JSON.stringify(data))`
- 使用 `localStorage.getItem('classroomGroups')` 读取数据

### 事件监听

```javascript
// 监听分组数据更新
window.addEventListener('storage', function(e) {
  if (e.key === 'classroomGroups') {
    // 处理数据更新
  }
});
```

## 集成说明

### 在其他页面中使用

```html
<!-- 引入脚本 -->
<script src="./assets/static/group-management.js"></script>

<!-- 添加按钮 -->
<button onclick="openGroupManagement()">打开分组管理</button>

<!-- 读取分组数据 -->
<script>
  const groupData = loadGroupData();
  console.log('当前分组:', groupData);
</script>
```

### 自定义回调

```javascript
// 监听分组数据更新
window.onGroupDataUpdated = function(data) {
  console.log('分组数据已更新:', data);
  // 更新UI显示
};
```

## 浏览器兼容性

- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

支持现代浏览器的拖拽API和localStorage。

## 注意事项

1. **数据安全**
   - 分组数据存储在浏览器本地
   - 清除浏览器缓存会丢失数据
   - 建议定期导出备份

2. **学生数据**
   - 学生数据从数据库实时加载
   - 支持多班级切换管理
   - 新增学生会自动出现在待分配池

3. **分组数量**
   - 默认支持4个分组
   - 可根据需要修改分组数量

4. **性能优化**
   - 支持大量学生（100+）的流畅操作
   - 使用事件委托优化性能

5. **班级选择**
   - 必须先选择班级才能加载学生
   - 切换班级会重新加载学生数据
   - 每个班级的分组数据独立保存

## 未来扩展

### 计划功能

- [ ] 导出分组数据为Excel
- [ ] 分组历史记录
- [ ] 分组模板保存
- [ ] 按成绩/性别等条件智能分组
- [ ] 分组评分统计
- [ ] 分组讨论记录

### 后端集成

```javascript
// 保存到服务器
async function saveGroupsToServer(groupData) {
  const response = await fetch('/api/groups/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(groupData)
  });
  return response.json();
}

// 从服务器加载
async function loadGroupsFromServer() {
  const response = await fetch('/api/groups/load');
  return response.json();
}
```

## 问题反馈

如有问题或建议，请联系开发者：徐汉初

## 更新日志

### v1.0.0 (2024-02-22)
- ✅ 初始版本发布
- ✅ 拖拽式分组功能
- ✅ 自动分组功能
- ✅ 数据持久化
- ✅ 集成到课堂教学主界面
- ✅ 从数据库加载真实学生数据
- ✅ 支持多班级管理
- ✅ 班级选择器
- ✅ 自动恢复分组状态
